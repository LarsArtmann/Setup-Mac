graph TB
    subgraph "CLI Layer"
        CLI[claude-conf.sh]
        Args[Command Arguments]
        Flags[Flags: --dry-run, --backup, --profile]
    end

    subgraph "Configuration Management Layer"
        ProfileManager[Profile Manager]
        ConfigLoader[Configuration Loader]
        Validator[Input Validator]
        BackupManager[Backup Manager]
    end

    subgraph "Core Business Logic"
        ProfileLogic[Profile Selection Logic]
        ConfigApplier[Configuration Applier]
        ValidationRules[Validation Rules]
        BackupLogic[Backup Creation Logic]
    end

    subgraph "External Integrations"
        ClaudeAPI[Claude CLI API]
        FileSystem[File System Operations]
        JSONProcessor[jq JSON Processing]
        Shell[Shell Environment]
    end

    subgraph "Data Layer"
        ConfigFiles[Configuration Files]
        BackupFiles[Backup Files]
        ProfileData[Profile Definitions]
        EnvironmentVars[Environment Variables]
    end

    %% CLI interactions
    CLI --> Args
    CLI --> Flags
    Args --> ProfileManager
    Flags --> ConfigLoader

    %% Configuration flow
    ProfileManager --> ProfileLogic
    ConfigLoader --> ConfigApplier
    Validator --> ValidationRules
    BackupManager --> BackupLogic

    %% Business logic interactions
    ProfileLogic --> ProfileData
    ConfigApplier --> ClaudeAPI
    ValidationRules --> ConfigFiles
    BackupLogic --> FileSystem

    %% External system interactions
    ClaudeAPI --> Shell
    FileSystem --> ConfigFiles
    FileSystem --> BackupFiles
    JSONProcessor --> ConfigFiles

    %% Data access patterns
    ProfileData --> EnvironmentVars
    ConfigFiles --> JSONProcessor
    BackupFiles --> BackupManager

    %% Current Architecture Issues
    CLI -.->|"Monolithic Script"| ProfileLogic
    ProfileLogic -.->|"Hard-coded Logic"| ValidationRules
    ConfigApplier -.->|"Direct Shell Calls"| ClaudeAPI
    BackupLogic -.->|"Manual File Operations"| FileSystem

    classDef currentImpl fill:#ffeecc,stroke:#cc8800
    classDef scriptBased fill:#ffcccc,stroke:#cc4400
    classDef external fill:#cceeff,stroke:#4488cc
    classDef data fill:#eeffcc,stroke:#88cc44

    class CLI,ProfileManager,ConfigLoader,Validator,BackupManager currentImpl
    class ProfileLogic,ConfigApplier,ValidationRules,BackupLogic scriptBased
    class ClaudeAPI,FileSystem,JSONProcessor,Shell external
    class ConfigFiles,BackupFiles,ProfileData,EnvironmentVars data