graph TB
    %% Setup-Mac Current Architecture - Network Monitoring Focus
    %% Analysis Date: 2025-07-21_02_33
    
    subgraph "Configuration Management Layer"
        FN[flake.nix<br/>Central Orchestration]
        FN --> CN[core.nix<br/>Nix Settings & GC]
        FN --> SN[system.nix<br/>macOS Preferences]
        FN --> EN[environment.nix<br/>300+ Packages]
        FN --> HN[homebrew.nix<br/>94 Casks]
        FN --> PN[programs.nix<br/>Fish Shell Config]
        FN --> NN[networking.nix<br/>Network Settings]
        FN --> UN[users.nix<br/>User Configuration]
    end
    
    subgraph "Task Management Layer"
        JF[justfile<br/>741 lines, 80+ commands]
        JF --> DS[Development Scripts]
        JF --> MS[Monitoring Scripts]
        JF --> BS[Benchmark Scripts]
        JF --> PS[Performance Scripts]
    end
    
    subgraph "Core System Integration"
        NH[nix-homebrew<br/>Declarative Management]
        DR[darwin-rebuild<br/>System Deployment]
        PC[pre-commit<br/>Code Quality Gates]
        TF[treefmt<br/>Code Formatting]
    end
    
    subgraph "Network Monitoring Stack"
        ND[Netdata<br/>localhost:19999<br/>System Performance]
        NT[ntopng<br/>localhost:3000<br/>Network Traffic]
        NTC[~/monitoring/netdata/config/<br/>netdata.conf]
        NTPC[~/monitoring/ntopng/config/<br/>ntopng.conf]
        ND -.-> NTC
        NT -.-> NTPC
    end
    
    subgraph "Security Monitoring Tools"
        LS[Little Snitch<br/>Network Connections]
        LU[LuLu<br/>Outgoing Firewall]
        BB[BlockBlock<br/>Persistence Monitor]
        OS[Oversight<br/>Camera/Mic Monitor]
        KK[KnockKnock<br/>Component Scanner]
        DD[DnD<br/>File Monitor]
    end
    
    subgraph "Performance Monitoring"
        SH[shell-performance-benchmark.sh<br/>Performance Analysis]
        PD[performance-data/<br/>shell-performance.json]
        PT[performance-thresholds.json<br/>Alert Thresholds]
        SH --> PD
        PD --> PT
    end
    
    subgraph "Shell Performance Stack"
        FS[Fish Shell<br/>10ms startup]
        CP[Carapace<br/>1000+ completions]
        SS[Starship<br/>Cross-shell prompt]
        FS --> CP
        FS --> SS
    end
    
    subgraph "Development Environment"
        GT[Go Toolchain<br/>templ, sqlc, delve]
        JS[JavaScript Stack<br/>bun, nodejs, pnpm]
        CT[Container Tools<br/>Docker, K8s]
        CL[Cloud Tools<br/>AWS, GCP, Terraform]
    end
    
    subgraph "Data Flow & Dependencies"
        FN ==> DR
        DR ==> NH
        EN ==> FS
        JF ==> ND
        JF ==> NT
        SH ==> FS
        PN ==> FS
    end
    
    %% Styling
    classDef config fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef monitoring fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef security fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef performance fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef shell fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    
    class FN,CN,SN,EN,HN,PN,NN,UN config
    class ND,NT,NTC,NTPC monitoring
    class LS,LU,BB,OS,KK,DD security
    class SH,PD,PT performance
    class FS,CP,SS shell