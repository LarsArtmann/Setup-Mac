graph TB
    %% Current Events & Commands Architecture
    %% Command Side (Write Operations)
    subgraph "Command Side (Write Operations)"
        direction TB
        subgraph "CLI Commands"
            clicommands[CLI Commands<br/>configure, backup, restore]
            cobracli[Cobra Command Parser<br/>Argument Validation]
        end
        
        subgraph "Application Commands"
            createconfig[CreateConfigurationCommand<br/>New Configuration Creation]
            changeconfig[ChangeConfigurationCommand<br/>Setting Updates]
            switchprofile[SwitchProfileCommand<br/>Profile Changes]
            createbackup[CreateBackupCommand<br/>Backup Operations]
            validateconfig[ValidateConfigurationCommand<br/>Configuration Validation]
        end
        
        subgraph "Command Handlers"
            createhandler[CreateConfigurationCommandHandler<br/>Domain Logic Execution]
            changehandler[ChangeConfigurationCommandHandler<br/>Business Rule Enforcement]
            switchhandler[SwitchProfileCommandHandler<br/>Profile Switching Logic]
            backuphandler[CreateBackupCommandHandler<br/>Backup Creation Logic]
            validatehandler[ValidateConfigurationCommandHandler<br/>Validation Logic]
        end
    end

    %% Domain Events
    subgraph "Domain Events (Current)"
        direction TB
        subgraph "Event Types"
            configcreated[ConfigurationCreated<br/>Aggregate Initialization]
            configchanged[ConfigurationChanged<br/>Setting Value Changes]
            profileswitched[ProfileSwitched<br/>Active Profile Changes]
            backupcreated[BackupCreated<br/>Backup Completion]
            configvalidated[ConfigurationValidated<br/>Validation Results]
        end
        
        subgraph "Event Properties"
            eventid[Event ID<br/>UUID-based Unique Identifier]
            aggregateid[Aggregate ID<br/>Configuration Instance ID]
            version[Version<br/>Optimistic Concurrency Control]
            timestamp[Timestamp<br/>Event Occurrence Time]
            payload[Payload<br/>Event-specific Data]
        end
    end

    %% Event Store (Current Implementation)
    subgraph "Event Store (In-Memory)"
        direction TB
        subgraph "Watermill Event Store"
            inmemorystore[In-Memory Storage<br/>Map-based Event Storage]
            gochannel[Go Channel PubSub<br/>Message Bus Implementation]
            concurrencycontrol[Concurrency Control<br/>Mutex-based Locking]
        end
        
        subgraph "Event Persistence"
            eventsmap[Events Map<br/>aggregateID -> []StoredEvent]
            versionsmap[Versions Map<br/>aggregateID -> currentVersion]
            serialization[JSON Serialization<br/>Event Data Marshaling]
        end
    end

    %% Query Side (Read Operations)
    subgraph "Query Side (Read Operations)"
        direction TB
        subgraph "Query Types"
            getconfig[GetConfigurationQuery<br/>Configuration Retrieval]
            getbyprofile[GetConfigurationByProfileQuery<br/>Profile-based Lookup]
            getall[GetAllConfigurationsQuery<br/>All Configurations]
            getprofiles[GetAvailableProfilesQuery<br/>Available Profiles]
            gethistory[GetConfigurationHistoryQuery<br/>Event History]
        end
        
        subgraph "Query Handlers"
            getconfighandler[GetConfigurationQueryHandler<br/>Configuration Projection]
            getprofilehandler[GetConfigurationByProfileQueryHandler<br/>Profile-based Retrieval]
            getallhandler[GetAllConfigurationsQueryHandler<br/>Multiple Configuration Projection]
            getprofileshandler[GetAvailableProfilesQueryHandler<br/>Profile Listing]
            gethistoryhandler[GetConfigurationHistoryQueryHandler<br/>Event History Retrieval]
        end
        
        subgraph "Read Models"
            configprojection[ConfigurationProjection<br/>Flattened Configuration View]
            profileprojection[ProfileProjection<br/>Profile Metadata]
            eventprojection[EventProjection<br/>Event History View]
            validationstatus[ValidationStatusProjection<br/>Current Validation State]
        end
    end

    %% Domain Aggregate
    subgraph "Configuration Aggregate"
        direction TB
        aggregate[Configuration Aggregate<br/>Business Logic Container]
        uncommittedevents[Uncommitted Events<br/>In-Memory Event Collection]
        eventapplication[Event Application<br/>State Reconstruction]
        businessrules[Business Rules<br/>Domain Invariants]
    end

    %% Message Bus Architecture
    subgraph "Message Bus (Watermill)"
        direction TB
        commandbus[Command Bus<br/>Command Routing]
        querybus[Query Bus<br/>Query Routing with Response]
        eventbus[Event Bus<br/>Event Publishing]
        topics[Topic-based Routing<br/>commands.*, queries.*, events.*]
    end

    %% Command Flow
    clicommands --> cobracli
    cobracli --> createconfig
    cobracli --> changeconfig
    cobracli --> switchprofile
    cobracli --> createbackup
    cobracli --> validateconfig
    
    createconfig --> commandbus
    changeconfig --> commandbus
    switchprofile --> commandbus
    createbackup --> commandbus
    validateconfig --> commandbus
    
    commandbus --> createhandler
    commandbus --> changehandler
    commandbus --> switchhandler
    commandbus --> backuphandler
    commandbus --> validatehandler
    
    createhandler --> aggregate
    changehandler --> aggregate
    switchhandler --> aggregate
    backuphandler --> aggregate
    validatehandler --> aggregate
    
    %% Event Flow
    aggregate --> uncommittedevents
    uncommittedevents --> configcreated
    uncommittedevents --> configchanged
    uncommittedevents --> profileswitched
    uncommittedevents --> backupcreated
    uncommittedevents --> configvalidated
    
    configcreated --> inmemorystore
    configchanged --> inmemorystore
    profileswitched --> inmemorystore
    backupcreated --> inmemorystore
    configvalidated --> inmemorystore
    
    inmemorystore --> eventsmap
    inmemorystore --> versionsmap
    inmemorystore --> gochannel
    
    %% Query Flow
    getconfig --> querybus
    getbyprofile --> querybus
    getall --> querybus
    getprofiles --> querybus
    gethistory --> querybus
    
    querybus --> getconfighandler
    querybus --> getprofilehandler
    querybus --> getallhandler
    querybus --> getprofileshandler
    querybus --> gethistoryhandler
    
    getconfighandler --> configprojection
    getprofilehandler --> configprojection
    getallhandler --> configprojection
    getprofileshandler --> profileprojection
    gethistoryhandler --> eventprojection
    
    %% Event Reconstruction
    inmemorystore --> eventapplication
    eventapplication --> aggregate
    
    %% Domain Event Properties
    configcreated --> eventid
    configcreated --> aggregateid
    configcreated --> version
    configcreated --> timestamp
    configcreated --> payload
    
    %% Styling
    classDef commandBox fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef eventBox fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef queryBox fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef storeBox fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef aggregateBox fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef busBox fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    
    class clicommands,cobracli,createconfig,changeconfig,switchprofile,createbackup,validateconfig,createhandler,changehandler,switchhandler,backuphandler,validatehandler commandBox
    class configcreated,configchanged,profileswitched,backupcreated,configvalidated,eventid,aggregateid,version,timestamp,payload eventBox
    class getconfig,getbyprofile,getall,getprofiles,gethistory,getconfighandler,getprofilehandler,getallhandler,getprofileshandler,gethistoryhandler,configprojection,profileprojection,eventprojection,validationstatus queryBox
    class inmemorystore,gochannel,concurrencycontrol,eventsmap,versionsmap,serialization storeBox
    class aggregate,uncommittedevents,eventapplication,businessrules aggregateBox
    class commandbus,querybus,eventbus,topics busBox